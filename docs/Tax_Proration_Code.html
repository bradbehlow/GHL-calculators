<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tax Proration Calculator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        position: relative;
        padding: 20px; /* Added padding for better spacing on all devices */
      }

      .container {
        background-color: #fff;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
        position: relative;
        /* Removed fixed margin-top and replaced with responsive approach */
        margin: 40px auto;
      }

      h1 {
        margin-bottom: 20px;
        text-align: center;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
      }

      input[type="date"],
      input[type="number"] {
        width: calc(100% - 10px);
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      button {
        width: 100%;
        padding: 10px;
        background-color: #28a745;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      button:hover {
        background-color: #218838;
      }

      .result {
        margin-top: 20px;
        padding: 10px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        text-align: center;
      }
      /* QR Code positioning - more responsive */
      .qr-promo-container {
        position: absolute;
        top: 20px;
        right: calc(100% + 20px); /* Position to the left of the container */
        padding: 8px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 8px;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        width: auto;
        z-index: 100;
      }

      .qr-promo-content {
        text-align: center;
        padding: 5px;
      }

      .qr-title {
        font-size: 1rem;
        color: #2c3e50;
        margin: 5px 0;
        font-weight: 600;
      }

      .qr-subtitle {
        font-size: 0.8rem;
        color: #7f8c8d;
        margin-bottom: 8px;
      }

      .qr-image-container {
        padding: 5px;
        background: white;
        border-radius: 5px;
        display: inline-block;
      }

      .qr-image {
        width: 100px;
        height: 100px;
        object-fit: contain;
      }

      /* Hide on mobile devices */
      @media (max-width: 768px) {
        .qr-promo-container {
          display: none;
        }
      }
      .disclaimer {
        margin-top: 2rem;
        padding: 1.5rem;
        background-color: #f8f9fa;
        border-left: 4px solid #6c757d;
        border-radius: 0 4px 4px 0;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .disclaimer h3 {
        margin-top: 0;
        margin-bottom: 0.75rem;
        color: #495057;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .disclaimer p {
        margin: 0;
        color: #6c757d;
      }

      @media (max-width: 768px) {
        .disclaimer {
          padding: 1rem;
          font-size: 0.85rem;
        }
      }
      /* ============================================= */

      /* Modal styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 900px;
        max-height: 90vh;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        transform: scale(0.9) translateY(20px);
        transition: all 0.3s ease;
        overflow: hidden;
      }

      .modal-overlay.active .modal-container {
        transform: scale(1) translateY(0);
      }

      .modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #f9fafb;
      }

      .modal-title {
        font-size: 18px;
        font-weight: 600;
        color: #374151;
      }

      .close-button {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        padding: 4px;
        border-radius: 8px;
        transition: all 0.2s ease;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-button:hover {
        background: #e5e7eb;
        color: #374151;
      }

      .tab-navigation {
        padding: 0 24px;
        background: #f9fafb;
        display: flex;
        gap: 8px;
        border-bottom: 1px solid #e5e7eb;
      }

      .tab-button {
        background: none;
        border: none;
        padding: 12px 16px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border-radius: 8px 8px 0 0;
        transition: all 0.2s ease;
        color: #6b7280;
      }

      .tab-button.active {
        background: #3b82f6;
        color: white;
        width: 20%;
      }

      .tab-button:not(.active):hover {
        background: #e5e7eb;
        color: #374151;
      }

      .modal-body {
        padding: 24px;
        max-height: 60vh;
        overflow-y: auto;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .code-container {
        background: #1f2937;
        border-radius: 8px;
        padding: 30px;
        margin-top: 12px;
        position: relative;
      }

      .code-block {
        color: #e5e7eb;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 13px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .copy-button {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 90px;
        background: #3b82f6;
        color: white;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .copy-button:hover {
        background: #2563eb;
      }

      .copy-button.copied {
        background: #059669;
      }

      .description {
        color: #6b7280;
        font-size: 14px;
        margin-bottom: 16px;
        line-height: 1.5;
      }

      @media (max-width: 768px) {
        .modal-container {
          width: 95%;
          margin: 20px;
        }

        .modal-header,
        .modal-body {
          padding: 16px;
        }

        .tab-navigation {
          padding: 0 16px;
        }
      }

      /* Embed button styles */
      .embed-button {
        position: relative;
        bottom: 0px;
        left: 90px;
        background: linear-gradient(135deg, #adade2, #41335e);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        z-index: 10;
        width: 50%;
      }

      .embed-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(79, 70, 229, 0.4);
      }
      /* ðŸ“± Mobile screens */
      @media (max-width: 768px) {
        .embed-button {
          position: relative;
          left: 43%; /* Center horizontally */
          transform: translateX(-7%);
          top: -10px; /* Adjust if needed */
          font-size: 12px; /* Slightly smaller text */
          padding: 10px 10px;
          margin-bottom: 25px;
        }
      }
      /* Media queries for better tablet responsiveness */
      @media (max-width: 1024px) {
        body {
          align-items: flex-start;
          padding-top: 60px;
        }

        .container {
          margin: 0 auto;
        }
      }

      @media (max-width: 768px) {
        .qr-promo-container {
          display: none;
        }

        .container {
          padding: 20px 15px;
        }
      }
    </style>
  </head>
  <script src="auth.js"></script>
  <body>
    <div class="container">
      <div class="qr-promo-container">
        <div class="qr-promo-content">
          <h2 class="qr-title">View on mobile</h2>
          <!-- <p class="qr-subtitle">Scan the QR code below</p> -->
          <div class="qr-image-container">
            <img
              src="https://res.cloudinary.com/dmdaa1heq/image/upload/v1749656207/Tax_Proration_Calculator_uvczb4.png"
              alt="Scan QR Code"
              class="qr-image"
            />
          </div>
        </div>
      </div>
      <!-- now the modal popup ===================================================-->
      <!-- Embed Button -->
      <button class="embed-button" id="embedButton">
        <i class="fas fa-code mr-2"></i>Add to Website
      </button>

      <!-- Modal -->
      <div class="modal-overlay" id="modalOverlay">
        <div class="modal-container">
          <div class="modal-header">
            <h2 class="modal-title">Add to Website</h2>
            <button class="close-button" id="closeModalBtn">&times;</button>
          </div>

          <!-- <div class="tab-navigation">
            <button class="tab-button active" data-tab="via-code">
              Via Code
            </button>
            <button class="tab-button" data-tab="via-gtm">Via GTM</button>
          </div> -->

          <div class="modal-body">
            <div class="tab-content active" id="via-code">
              <p class="description">
                Copy this code to embed the calculator on your website
              </p>
              <div class="code-container">
                <button class="copy-button" id="copyBtn">Copy</button>
                <pre class="code-block" id="codeBlock">
                    <!-- &lt;iframe src="https://calculators.konnectd.io/Tax_Proration_Code.html?location=LOCATION_ID_PLACEHOLDER" width="100%" height="800" frameborder="0" style="border: none;"&gt;&lt;/iframe&gt; -->
                      https://calculators.konnectd.io/Tax_Proration_Code.html?location=LOCATION_ID_PLACEHOLDER
                    </pre>
              </div>
            </div>

            <div class="tab-content" id="via-gtm">
              <p class="description">
                Add this code through Google Tag Manager
              </p>
              <div class="code-container">
                <button class="copy-button" id="copyBtnGTM">Copy</button>
                <pre class="code-block" id="codeBlockGTM">
                  &lt;script&gt;
                  // Google Tag Manager code for embedding calculator
                  (function() {
                    var iframe = document.createElement('iframe');
                    iframe.src = 'https://calculators.konnectd.io/Tax_Proration_Code.html';
                    iframe.width = '100%';
                    iframe.height = '800';
                    iframe.style.border = 'none';
                    document.getElementById('calculator-container').appendChild(iframe);
                  })();
                  &lt;/script&gt;</pre
                >
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- end modal popup =========================================================== -->

      <h1>Tax Proration Calculator</h1>
      <form id="proration-form">
        <div class="form-group">
          <label for="closing-date">Closing Date:</label>
          <input type="date" id="closing-date" required />
        </div>
        <div class="form-group">
          <label for="due-date">Due Date:</label>
          <input type="date" id="due-date" required />
        </div>
        <div class="form-group">
          <label for="annual-taxes">Annual Taxes:</label>
          <input type="number" id="annual-taxes" required />
        </div>
        <button type="submit">Calculate</button>
      </form>
      <div id="result" class="result"></div>
      <div class="disclaimer">
        <h3>Disclaimer</h3>
        <p>
          All calculations are estimates for informational use only and based on
          data entered by the user. Results do not reflect guaranteed terms,
          rates, or outcomes. Additional costs (e.g. PMI, FHA, VA, USDA fees)
          may apply depending on loan structure. Provided by Konnectd as a
          reference tool only.
        </p>
      </div>
    </div>

    <script>
      document
        .getElementById("proration-form")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Prevents the form from refreshing the page

          const closingDate = new Date(
            document.getElementById("closing-date").value
          );
          const dueDate = new Date(document.getElementById("due-date").value);
          const annualTaxes = parseFloat(
            document.getElementById("annual-taxes").value
          );

          // Check if the year is a leap year
          const isLeapYear = (year) => {
            return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
          };

          const daysInYear = isLeapYear(closingDate.getFullYear()) ? 366 : 365;

          // Calculate the daily tax rate
          const dailyTaxRate = annualTaxes / daysInYear;

          // Calculate the number of days from the closing date to the due date
          const daysBuyerOwned = Math.floor(
            (dueDate - closingDate) / (1000 * 60 * 60 * 24)
          );

          // Calculate the portion the buyer should pay
          const buyerPortion = daysBuyerOwned * dailyTaxRate;

          // Calculate the credit amount to the buyer
          const creditToBuyer = annualTaxes - buyerPortion;

          let resultText = `Credit: $${creditToBuyer.toFixed(2)}`;

          document.getElementById("result").innerHTML = `<p>${resultText}</p>`;
        });
      //making it secureeee
      // Disable right-click
      document.addEventListener("contextmenu", function (e) {
        e.preventDefault();
      });

      // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U, Ctrl+S, etc.
      document.onkeydown = function (e) {
        if (
          e.key === "F12" ||
          (e.ctrlKey &&
            e.shiftKey &&
            (e.key === "I" || e.key === "J" || e.key === "C")) ||
          (e.ctrlKey && (e.key === "U" || e.key === "S"))
        ) {
          e.preventDefault();
          return false;
        }
      };

      // Modal functionality
      document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("modalOverlay");
        const embedButton = document.getElementById("embedButton");
        const closeButton = document.getElementById("closeModalBtn");
        const tabButtons = document.querySelectorAll(".tab-button");
        const tabContents = document.querySelectorAll(".tab-content");
        const copyButtons = document.querySelectorAll(".copy-button");

        // Open modal
        embedButton.addEventListener("click", () => {
          modal.classList.add("active");
          document.body.style.overflow = "hidden";
        });

        // Close modal
        closeButton.addEventListener("click", () => {
          modal.classList.remove("active");
          document.body.style.overflow = "";
        });

        // Close modal when clicking outside
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.classList.remove("active");
            document.body.style.overflow = "";
          }
        });

        // Handle escape key
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && modal.classList.contains("active")) {
            modal.classList.remove("active");
            document.body.style.overflow = "";
          }
        });

        // Tab functionality
        tabButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const tabId = button.dataset.tab;

            // Remove active class from all tabs and contents
            tabButtons.forEach((btn) => btn.classList.remove("active"));
            tabContents.forEach((content) =>
              content.classList.remove("active")
            );

            // Add active class to selected tab and content
            button.classList.add("active");
            document.getElementById(tabId).classList.add("active");
          });
        });

        // Copy functionality
        copyButtons.forEach((button) => {
          button.addEventListener("click", (e) => {
            const codeBlock = button.parentElement.querySelector(".code-block");
            const text = codeBlock.textContent;

            copyToClipboard(text, button);
          });
        });

        // Copy to clipboard function
        async function copyToClipboard(text, button) {
          try {
            await navigator.clipboard.writeText(text);

            // Visual feedback
            const originalText = button.textContent;
            button.textContent = "Copied!";
            button.classList.add("copied");

            setTimeout(() => {
              button.textContent = originalText;
              button.classList.remove("copied");
            }, 2000);
          } catch (err) {
            console.error("Failed to copy text: ", err);

            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);

            button.textContent = "Copied!";
            button.classList.add("copied");
            setTimeout(() => {
              button.textContent = "Copy";
              button.classList.remove("copied");
            }, 2000);
          }
        }
      });
      // securing end
    </script>

    <script>
      // Function to get URL parameters
      function getUrlParameter(name) {
        name = name.replace(/[\[\]]/g, "\\$&");
        const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
        const results = regex.exec(window.location.href);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      // Get location ID from URL
      const locationId = getUrlParameter("locationid");
    </script>

    <script>
      // Function to update embed code with actual location ID
      function updateEmbedCode() {
        if (locationId) {
          const codeBlock = document.getElementById("codeBlock");
          if (codeBlock) {
            const embedCode = `https://calculators.konnectd.io/Tax_Proration_Code.html?location=${locationId}`;
            codeBlock.textContent = embedCode;
          }
        }
      }

      // Update embed code when page loads
      document.addEventListener("DOMContentLoaded", updateEmbedCode);
    </script>
  </body>
</html>
