<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cost of Waiting Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;1,300;1,400&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f5f7fa;
      }
      .serif-italic {
        font-family: "Merriweather", serif;
        font-style: italic;
        font-weight: 400;
      }
      .tooltip {
        position: relative;
        display: inline-block;
        cursor: pointer;
      }
      .tooltip .tooltiptext {
        visibility: hidden;
        width: 240px;
        background-color: #333;
        color: #fff;
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.875rem;
        line-height: 1.25rem;
      }
      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      .input-group {
        position: relative;
      }
      .input-group .prefix {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #64748b;
      }
      .input-group .suffix {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #64748b;
      }
      .input-group input {
        padding-left: 28px;
      }
      .input-group input.with-suffix {
        padding-right: 28px;
      }

      /* Hide number input spinners */
      .no-spin::-webkit-outer-spin-button,
      .no-spin::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      .no-spin {
        -moz-appearance: textfield;
      }
      .increase {
        color: #ef4444;
        text-align: right;
        font-weight: 600;
      }
      .decrease {
        color: #10b981;
        text-align: right;
        font-weight: 600;
      }
      .table-value {
        text-align: right;
        font-weight: 600;
      }
      .table-header {
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.05em;
      }
      .yellow-underline {
        position: relative;
        display: inline-block;
      }
      .yellow-underline::after {
        content: "";
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        bottom: -6px;
        width: 330px;
        height: 3px;
        background-color: #fbbf24;
        border-radius: 1px;
      }

      .yellow-underline2 {
        position: relative;
        display: inline-block;
      }
      .yellow-underline2::after {
        content: "";
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        top: 55px;
        bottom: -6px;
        width: 100px;
        height: 3px;
        background-color: #fbbf24;
        border-radius: 1px;
      }

      .yellow-underline3 {
        position: relative;
        display: inline-block;
      }
      .yellow-underline3::after {
        content: "";
        position: absolute;
        left: 200%;
        transform: translateX(-50%);
        top: 27px;
        bottom: -6px;
        width: 250px;
        height: 3px;
        background-color: #fbbf24;
        border-radius: 1px;
      }
      .info-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        border: 1px solid #64748b;
        border-radius: 50%;
        color: #64748b;
        font-size: 10px;
        font-style: italic;
        margin-left: 4px;
        cursor: pointer;
      }
      .loading-spinner {
        display: inline-block;
        width: 1em;
        height: 1em;
        border: 2px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top-color: #3498db;
        animation: spin 1s ease-in-out infinite;
        margin-right: 0.5em;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .disclaimer {
        margin-top: 2rem;
        padding: 1.5rem;
        background-color: #f8f9fa;
        border-left: 4px solid #6c757d;
        border-radius: 0 4px 4px 0;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .disclaimer h3 {
        margin-top: 0;
        margin-bottom: 0.75rem;
        color: #495057;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .disclaimer p {
        margin: 0;
        color: #6c757d;
      }

      @media (max-width: 768px) {
        .disclaimer {
          padding: 1rem;
          font-size: 0.85rem;
        }
      }
      .qr-promo-container {
        margin: 10px 0 20px 0;
        padding: 8px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 8px;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        width: fit-content;
        max-width: 200px;
      }

      .qr-promo-content {
        text-align: center;
        padding: 5px;
      }

      .qr-title {
        font-size: 1rem;
        color: #2c3e50;
        margin: 5px 0;
        font-weight: 600;
      }

      .qr-subtitle {
        font-size: 0.8rem;
        color: #7f8c8d;
        margin-bottom: 8px;
      }

      .qr-image-container {
        padding: 5px;
        background: white;
        border-radius: 5px;
        display: inline-block;
      }

      .qr-image {
        width: 100px;
        height: 100px;
        object-fit: contain;
      }

      /* Hide on mobile devices */
      @media (max-width: 768px) {
        .qr-promo-container {
          display: none;
        }
      }

      /*    ====================*/

      /*tool tip for last row */

      .tooltip-container {
        position: relative;
        display: inline-block;
        cursor: pointer;
      }

      .tooltip-content1 {
        visibility: hidden;
        width: 240px;
        background-color: #333;
        color: #fff;
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 100%;
        transform: translateX(-100%);
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.875rem;
        line-height: 1.25rem;
      }

      .tooltip-container:hover .tooltip-content1 {
        visibility: visible;
        opacity: 1;
      }

      .tooltip-indicator {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        border: 1px solid #64748b;
        border-radius: 50%;
        color: #64748b;
        font-size: 10px;
        font-style: italic;
        margin-left: 4px;
        cursor: pointer;
      }

      /* Mobile Responsive Adjustments */
      @media (max-width: 768px) {
        .tooltip-content1 {
          width: 180px;
          font-size: 0.75rem;
          line-height: 1.2;
          padding: 8px;
        }

        .tooltip-right .tooltip-content1 {
          left: 0;
          right: 0;
          transform: none;
        }

        .tooltip-left .tooltip-content1 {
          left: 0;
          right: auto;
          transform: none;
        }
      }

      /* Touch Device Support */
      @media (hover: none) {
        .tooltip-active .tooltip-content1 {
          visibility: visible;
          opacity: 1;
        }
      }

      /* ===== Tooltip System - Updated Class Names ===== */
      .tooltip-container {
        position: relative;
        display: inline-block;
        cursor: pointer;
      }

      .tooltip-content {
        visibility: hidden;
        width: 240px;
        background-color: #333;
        color: #fff;
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        right: 90%;
        transform: translateX(90%);
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.875rem;
        line-height: 1.25rem;
      }

      .tooltip-container:hover .tooltip-content {
        visibility: visible;
        opacity: 1;
      }

      .tooltip-indicator {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        border: 1px solid #64748b;
        border-radius: 50%;
        color: #64748b;
        font-size: 10px;
        font-style: italic;
        margin-left: 4px;
        cursor: pointer;
      }

      /* Mobile Responsive Adjustments */
      @media (max-width: 768px) {
        .tooltip-content {
          width: 180px;
          font-size: 0.75rem;
          line-height: 1.2;
          padding: 8px;
        }

        .tooltip-right .tooltip-content {
          left: 0;
          right: 0;
          transform: none;
        }

        .tooltip-left .tooltip-content {
          left: 0;
          right: auto;
          transform: none;
        }
      }

      /* Touch Device Support */
      @media (hover: none) {
        .tooltip-active .tooltip-content {
          visibility: visible;
          opacity: 1;
        }
      }

      /* ============================================= */

      /* Modal styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 900px;
        max-height: 90vh;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        transform: scale(0.9) translateY(20px);
        transition: all 0.3s ease;
        overflow: hidden;
      }

      .modal-overlay.active .modal-container {
        transform: scale(1) translateY(0);
      }

      .modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #f9fafb;
      }

      .modal-title {
        font-size: 18px;
        font-weight: 600;
        color: #374151;
      }

      .close-button {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        padding: 4px;
        border-radius: 8px;
        transition: all 0.2s ease;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-button:hover {
        background: #e5e7eb;
        color: #374151;
      }

      .tab-navigation {
        padding: 0 24px;
        background: #f9fafb;
        display: flex;
        gap: 8px;
        border-bottom: 1px solid #e5e7eb;
      }

      .tab-button {
        background: none;
        border: none;
        padding: 12px 16px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border-radius: 8px 8px 0 0;
        transition: all 0.2s ease;
        color: #6b7280;
      }

      .tab-button.active {
        background: #3b82f6;
        color: white;
      }

      .tab-button:not(.active):hover {
        background: #e5e7eb;
        color: #374151;
      }

      .modal-body {
        padding: 24px;
        max-height: 60vh;
        overflow-y: auto;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .code-container {
        background: #1f2937;
        border-radius: 8px;
        padding: 30px;
        margin-top: 16px;
        position: relative;
      }

      .code-block {
        color: #e5e7eb;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 13px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-break: break-all;
        padding: 30px;
      }

      .copy-button {
        position: absolute;
        top: 12px;
        right: 12px;
        background: #3b82f6;
        color: white;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .copy-button:hover {
        background: #2563eb;
      }

      .copy-button.copied {
        background: #059669;
      }

      .description {
        color: #6b7280;
        font-size: 14px;
        margin-bottom: 16px;
        line-height: 1.5;
      }

      @media (max-width: 768px) {
        .modal-container {
          width: 95%;
          margin: 20px;
        }

        .modal-header,
        .modal-body {
          padding: 16px;
        }

        .tab-navigation {
          padding: 0 16px;
        }
      }

      /* Embed button styles */
      .embed-button {
        position: relative;
        bottom: 100px;
        left: 900px;
        background: linear-gradient(135deg, #adade2, #41335e);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        z-index: 10;
      }

      .embed-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(79, 70, 229, 0.4);
      }
      /* 📱 Mobile screens */
      @media (max-width: 768px) {
        .embed-button {
          left: 43%; /* Center horizontally */
          transform: translateX(-7%);
          bottom: 10px; /* Adjust if needed */
          font-size: 12px; /* Slightly smaller text */
          padding: 12px 16px;
        }
      }

      /* 📱 Extra small screens */
      @media (max-width: 480px) {
        .embed-button {
          bottom: 30px; /* Bring closer */
          font-size: 11px;
          padding: 6px 14px;
        }
      }
    </style>
  </head>
  <script src="auth.js"></script>
  <body>
    <div class="container mx-auto px-4 py-8 max-w-6xl">
      <!-- qr code area -->
      <div class="qr-promo-container">
        <div class="qr-promo-content">
          <h2 class="qr-title">View on mobile</h2>
          <!-- <p class="qr-subtitle">Scan the QR code below</p> -->
          <div class="qr-image-container">
            <img
              src="https://res.cloudinary.com/dmdaa1heq/image/upload/v1750269899/Cost_of_Waiting_Calculator_bcfk1d.png"
              alt="Scan QR Code"
              class="qr-image"
            />
          </div>
        </div>
      </div>
      <!-- now the modal popup -->
      <!-- Embed Button -->
      <button class="embed-button" id="embedButton">
        <!-- <i class="fas fa-code mr-2"></i> -->
        Get Code
      </button>

      <!-- Modal -->
      <div class="modal-overlay" id="modalOverlay">
        <div class="modal-container">
          <div class="modal-header">
            <h2 class="modal-title">Get Code</h2>
            <button class="close-button" id="closeModalBtn">&times;</button>
          </div>

          <div class="tab-navigation">
            <button class="tab-button active" data-tab="via-code">
              Via Code
            </button>
            <!-- <button class="tab-button" data-tab="via-gtm">Via GTM</button> -->
          </div>

          <div class="modal-body">
            <div class="tab-content active" id="via-code">
              <p class="description">
                Copy this code to embed the calculator on your website
              </p>
              <div class="code-container">
                <button class="copy-button" id="copyBtn">Copy</button>
                <pre class="code-block" id="codeBlock">
                  &lt;iframe src="https://calculators.konnectd.io/Cost_Of_Waiting_Calculator.html?location={{location.id}}" width="100%" height="800" frameborder="0" style="border: none;"&gt;&lt;/iframe&gt;</pre
                >
              </div>
            </div>

            <div class="tab-content" id="via-gtm">
              <p class="description">
                Add this code through Google Tag Manager
              </p>
              <div class="code-container">
                <button class="copy-button" id="copyBtnGTM">Copy</button>
                <pre class="code-block" id="codeBlockGTM">
                  &lt;script&gt;
                  // Google Tag Manager code for embedding calculator
                  (function() {
                    var iframe = document.createElement('iframe');
                    iframe.src = 'https://calculators.konnectd.io/Cost_Of_Waiting_Calculator.html';
                    iframe.width = '100%';
                    iframe.height = '800';
                    iframe.style.border = 'none';
                    document.getElementById('calculator-container').appendChild(iframe);
                  })();
                  &lt;/script&gt;</pre
                >
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- end modal popup -->
      <div class="flex flex-col lg:flex-row gap-8">
        <!-- Left Side Panel: User Input -->
        <div class="w-full lg:w-2/5">
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="mb-6 text-gray-800">
              <span
                class="yellow-underline3 serif-italic font-light text-gray-500"
                >Example</span
              >
              <span class="font-bold text-2xl">Home Purchase</span>
            </h2>

            <div class="space-y-5">
              <div class="space-y-2">
                <label
                  for="purchasePrice"
                  class="block text-sm font-medium text-gray-700"
                  >Purchase Price</label
                >
                <div class="input-group">
                  <span class="prefix">$</span>
                  <input
                    type="number"
                    id="purchasePrice"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 no-spin"
                    value="500000"
                    onwheel="this.blur()"
                  />
                </div>
              </div>

              <div class="space-y-2">
                <label
                  for="downPayment"
                  class="block text-sm font-medium text-gray-700"
                  >Down Payment</label
                >
                <div class="input-group">
                  <input
                    type="number"
                    id="downPayment"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 with-suffix no-spin"
                    value="10"
                    onwheel="this.blur()"
                  />
                  <span class="suffix">%</span>
                </div>
              </div>

              <div class="space-y-2">
                <label
                  for="interestRate"
                  class="block text-sm font-medium text-gray-700"
                >
                  Interest Rate
                  <span class="tooltip ml-1">
                    <span class="info-icon">i</span>
                    <span class="tooltiptext"
                      >The current interest rate for a 30-year fixed mortgage.
                      This affects your monthly payment amount.</span
                    >
                  </span>
                </label>
                <div class="input-group">
                  <input
                    type="number"
                    id="interestRate"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 with-suffix no-spin"
                    step="0.01"
                    value="7.25"
                    onwheel="this.blur()"
                  />
                  <span class="suffix">%</span>
                </div>
              </div>

              <div class="space-y-2">
                <label
                  for="averageFees"
                  class="block text-sm font-medium text-gray-700"
                >
                  Average Fees
                  <span class="tooltip ml-1">
                    <span class="info-icon">i</span>
                    <span class="tooltiptext"
                      >Typical closing costs, origination fees, and other
                      expenses associated with obtaining a mortgage.</span
                    >
                  </span>
                </label>
                <div class="input-group">
                  <input
                    type="number"
                    id="averageFees"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 with-suffix no-spin"
                    step="0.01"
                    value="1.25"
                    onwheel="this.blur()"
                  />
                  <span class="suffix">%</span>
                </div>
              </div>

              <div class="space-y-2">
                <label
                  for="homeAppreciation"
                  class="block text-sm font-medium text-gray-700"
                >
                  Potential Home Appreciation
                  <span class="tooltip ml-1">
                    <span class="info-icon">i</span>
                    <span class="tooltiptext"
                      >Estimated annual increase in home value if you wait to
                      purchase.</span
                    >
                  </span>
                </label>
                <div class="input-group">
                  <input
                    type="number"
                    id="homeAppreciation"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 with-suffix no-spin"
                    step="0.01"
                    value="6"
                    onwheel="this.blur()"
                  />
                  <span class="suffix">%</span>
                </div>
              </div>

              <div class="space-y-2">
                <label
                  for="rateChange"
                  class="block text-sm font-medium text-gray-700"
                >
                  Potential Interest Rate Change
                  <span class="tooltip ml-1">
                    <span class="info-icon">i</span>
                    <span class="tooltiptext"
                      >Projected change in interest rates if you wait to
                      purchase. Use negative values for decreases.</span
                    >
                  </span>
                </label>
                <div class="input-group">
                  <input
                    type="number"
                    id="rateChange"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 with-suffix no-spin"
                    step="0.01"
                    value="-1.5"
                    onwheel="this.blur()"
                  />
                  <span class="suffix">%</span>
                </div>
              </div>

              <button
                id="updateButton"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-md transition duration-200 mt-4"
              >
                UPDATE
              </button>

              <div class="flex justify-center mt-2">
                <button
                  id="savePDF"
                  class="flex items-center text-blue-600 hover:text-blue-800"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5 mr-1"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    />
                  </svg>
                  Save as PDF
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Side Panel: Results Display -->
        <div class="w-full lg:w-3/5">
          <!-- Main Headline -->
          <div class="text-center mb-6">
            <h1 class="serif-italic text-2xl text-gray-800 mb-2">
              <span class="yellow-underline"
                >Understand the Cost of Waiting</span
              >
            </h1>
            <p class="text-sm text-gray-500 max-w-lg mx-auto">
              Waiting could save you monthly but it will cost you thousands more
              over the life of the loan.
            </p>
          </div>

          <!-- Top Metrics -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
              <h3 class="serif-italic text-lg font-bold text-black-500 mb-1">
                <span class="yellow-underline2">Years to Recapture</span
                ><br />Lost Equity
              </h3>
              <p id="yearsToRecapture" class="text-3xl font-bold text-gray-800">
                10 Years
              </p>
            </div>
            <!-- <div class="bg-white rounded-xl shadow-lg p-6 text-center">
              <h3 class="serif-italic text-lg font-bold text-black-500 mb-1">
                <span class="yellow-underline2">Lost Equity and</span><br />Down
                Payment
              </h3>
              <p id="lostEquity" class="text-3xl font-bold text-gray-800">
                $33,000
              </p>
            </div> -->
            <!-- Updated KPI Tile (in the top metrics section) -->
            <div class="bg-white rounded-xl shadow-lg p-6 text-center relative">
              <!-- Tooltip Icon (Top-Right) -->
              <div class="absolute top-2 right-2 tooltip-container">
                <i class="fas fa-info-circle text-gray-400 cursor-pointer"></i>
                <span class="tooltip-content1">
                  <div class="text-sm">
                    <div class="flex justify-between">
                      <span>Principal paid in Year 1</span>
                      <span id="tooltipPrincipal">$0</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Extra down payment later</span>
                      <span id="tooltipExtraDown">$0</span>
                    </div>
                    <hr class="my-1 border-gray-400" />
                    <div class="flex justify-between font-semibold">
                      <span>Lost Equity & Down Pmt</span>
                      <span id="tooltipTotal">$0</span>
                    </div>
                  </div>
                </span>
              </div>
              <h3 class="serif-italic text-lg font-bold text-black-500 mb-1">
                <span class="yellow-underline2">Lost Equity and</span><br />Down
                Payment
              </h3>
              <p id="lostEquity" class="text-3xl font-bold text-gray-800">$0</p>
            </div>
          </div>

          <!-- Detailed Comparison Table -->
          <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="bg-gray-50">
                    <th
                      class="px-6 py-4 text-left text-sm text-gray-500 table-header"
                    ></th>
                    <th
                      class="px-6 py-4 text-right text-sm text-gray-500 table-header"
                    >
                      Buy Now
                    </th>
                    <th
                      class="px-6 py-4 text-right text-sm text-gray-500 table-header"
                    >
                      Buy Later
                    </th>
                    <th
                      class="px-6 py-4 text-right text-sm text-gray-500 table-header"
                    >
                      Change
                    </th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                  <tr>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                      Purchase Price
                    </td>
                    <td
                      id="buyNowPrice"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $500,000
                    </td>
                    <td
                      id="buyLaterPrice"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $530,000
                    </td>
                    <td id="priceChange" class="px-6 py-4 text-sm increase">
                      ↑ $30,000
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                      Down Payment
                    </td>
                    <td
                      id="buyNowDown"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $50,000
                    </td>
                    <td
                      id="buyLaterDown"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $53,000
                    </td>
                    <td id="downChange" class="px-6 py-4 text-sm increase">
                      ↑ $3,000
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                      Loan Amount
                    </td>
                    <td
                      id="buyNowLoan"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $450,000
                    </td>
                    <td
                      id="buyLaterLoan"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $477,000
                    </td>
                    <td id="loanChange" class="px-6 py-4 text-sm increase">
                      ↑ $27,000
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                      Loan Payment
                      <span class="tooltip-container tooltip-right ml-1">
                        <span class="tooltip-indicator">i</span>
                        <span class="tooltip-content">
                          Monthly payment based on a 30-year fixed-rate
                          mortgage.
                        </span>
                      </span>
                    </td>
                    <td
                      id="buyNowPayment"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $3,070
                    </td>
                    <td
                      id="buyLaterPayment"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $2,784
                    </td>
                    <td id="paymentChange" class="px-6 py-4 text-sm decrease">
                      ↓ $-286
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                      Average Fees
                      <span class="tooltip-container tooltip-right ml-1">
                        <span class="tooltip-indicator">i</span>
                        <span class="tooltip-content"
                          >Typical closing costs, origination fees, and other
                          expenses associated with obtaining a mortgage.</span
                        >
                      </span>
                    </td>
                    <td
                      id="buyNowFees"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $5,625
                    </td>
                    <td
                      id="buyLaterFees"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      $5,963
                    </td>
                    <td id="feesChange" class="px-6 py-4 text-sm increase">
                      ↑ $338
                    </td>
                  </tr>
                  <tr>
                    <!-- change --------------------------------- -->
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                      Rate Change (Future – Today)
                      <span class="tooltip-container tooltip-right ml-1">
                        <span class="tooltip-indicator">i</span>
                        <span class="tooltip-content">
                          Today's rate:
                          <span id="tooltipCurrentRate">7.25%</span><br />
                          Future rate: <span id="tooltipFutureRate">5.75%</span
                          ><br />
                          Change:
                          <span id="tooltipRateChange">-1.50% lower</span>
                        </span>
                      </span>
                    </td>
                    <!-- ------------------------------------------ -->
                    <td
                      id="buyNowRate"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      7.25%
                    </td>
                    <td
                      id="buyLaterRate"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      5.75%
                    </td>
                    <td
                      id="rateChangeDisplay"
                      class="px-6 py-4 text-sm decrease"
                    >
                      ↓ -1.5%
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                      Estimated APR
                    </td>
                    <td
                      id="buyNowAPR"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      7.454%
                    </td>
                    <td
                      id="buyLaterAPR"
                      class="px-6 py-4 text-sm text-gray-700 table-value"
                    >
                      6.332%
                    </td>
                    <td id="aprChange" class="px-6 py-4 text-sm decrease">
                      ↓ -1.122%
                    </td>
                  </tr>
                  <!-- Replace the existing grey row with this one -->

                  <!-- Update the grey sub-row (add Font Awesome and fix tooltip) -->
                  <!-- Add this after the last table row (before </tbody>) -->
                  <!-- <tr id="lostEquityRow" class="bg-gray-50">
                    <td class="px-6 py-2 text-sm font-medium text-gray-800">
                      Lost Equity & Down Pmt
                    </td>
                    <td
                      colspan="3"
                      class="px-6 py-2 text-sm text-gray-700 table-value"
                    >
                      <div
                        class="tooltip-container inline-flex items-center tooltip-left"
                      > -->
                  <!-- Add 'tooltip-left' class -->
                  <!-- <span id="lostEquityAndDownPmt">$0</span>
                        <i class="fas fa-info-circle ml-1 text-gray-400"></i>
                        <span class="tooltip-content1">
                          <div class="text-sm">
                            <div class="flex justify-between">
                              <span>Principal paid in Year 1</span>
                              <span id="tooltipPrincipal">$0</span>
                            </div>
                            <div class="flex justify-between">
                              <span>Extra down payment later</span>
                              <span id="tooltipExtraDown">$0</span>
                            </div>
                            <hr class="my-1 border-gray-400" />
                            <div class="flex justify-between font-semibold">
                              <span>Lost Equity & Down Pmt</span>
                              <span id="tooltipTotal">$0</span>
                            </div>
                          </div>
                        </span>
                      </div>
                    </td>
                  </tr> -->
                  <!-- dfdf -->
                </tbody>
              </table>
            </div>
            <div
              class="px-6 py-6 text-xs text-gray-400 italic text-center mt-2"
            >
              Values are for illustration purposes only.
            </div>
          </div>
        </div>
      </div>

      <div class="disclaimer">
        <h3>Disclaimer</h3>
        <p>
          This calculator is intended for educational purposes only. All figures
          are estimates based on borrower-provided inputs and do not represent a
          formal loan offer. Actual results may vary. For personalized
          information based on your situation, please speak directly with your
          loan advisor.
        </p>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Modal functionality ------------------------------------------------------------------------
        //]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]

        const modal = document.getElementById("modalOverlay");
        const embedButton = document.getElementById("embedButton");
        const closeButton = document.getElementById("closeModalBtn");
        const tabButtons = document.querySelectorAll(".tab-button");
        const tabContents = document.querySelectorAll(".tab-content");
        const copyButtons = document.querySelectorAll(".copy-button");

        // Open modal
        embedButton.addEventListener("click", () => {
          modal.classList.add("active");
          document.body.style.overflow = "hidden";
        });

        // Close modal
        closeButton.addEventListener("click", () => {
          modal.classList.remove("active");
          document.body.style.overflow = "";
        });

        // Close modal when clicking outside
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.classList.remove("active");
            document.body.style.overflow = "";
          }
        });

        // Handle escape key
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && modal.classList.contains("active")) {
            modal.classList.remove("active");
            document.body.style.overflow = "";
          }
        });

        // Tab functionality
        tabButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const tabId = button.dataset.tab;

            // Remove active class from all tabs and contents
            tabButtons.forEach((btn) => btn.classList.remove("active"));
            tabContents.forEach((content) =>
              content.classList.remove("active")
            );

            // Add active class to selected tab and content
            button.classList.add("active");
            document.getElementById(tabId).classList.add("active");
          });
        });

        // Copy functionality
        copyButtons.forEach((button) => {
          button.addEventListener("click", (e) => {
            const codeBlock = button.parentElement.querySelector(".code-block");
            const text = codeBlock.textContent;

            copyToClipboard(text, button);
          });
        });

        // Copy to clipboard function
        async function copyToClipboard(text, button) {
          try {
            await navigator.clipboard.writeText(text);

            // Visual feedback
            const originalText = button.textContent;
            button.textContent = "Copied!";
            button.classList.add("copied");

            setTimeout(() => {
              button.textContent = originalText;
              button.classList.remove("copied");
            }, 2000);
          } catch (err) {
            console.error("Failed to copy text: ", err);

            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);

            button.textContent = "Copied!";
            button.classList.add("copied");
            setTimeout(() => {
              button.textContent = "Copy";
              button.classList.remove("copied");
            }, 2000);
          }
        }

        // end moda functionality =============================================================================

        // ]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]
        // Initial calculation
        calculateResults();

        // Add event listener to update button
        document
          .getElementById("updateButton")
          .addEventListener("click", calculateResults);

        // Add event listener to save PDF button
        /*   document
          .getElementById("savePDF")
          .addEventListener("click", function () {
            alert("PDF export functionality would be implemented here.");
            // In a real implementation, this would generate a PDF of the calculator results
          });
      */

        document
          .getElementById("savePDF")
          .addEventListener("click", function () {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
              orientation: "portrait",
              unit: "mm",
              format: "a4",
            });

            // Set default font
            doc.setFont("helvetica");
            doc.setTextColor(31, 41, 55); // text-gray-800

            // Function to get change value with type
            const getChangeValue = (elementId) => {
              const el = document.getElementById(elementId);
              if (!el) return { value: "", type: "neutral" };

              // Extract numeric value
              const numericValue = parseFloat(
                el.textContent.replace(/[^\d.-]/g, "")
              );

              // Determine type from class
              const type = el.classList.contains("increase")
                ? "increase"
                : el.classList.contains("decrease")
                ? "decrease"
                : "neutral";

              return { value: numericValue, type };
            };

            // Function to get regular value
            const getCleanValue = (elementId) => {
              const el = document.getElementById(elementId);
              if (!el) return "";
              return el.textContent.replace(/\s+/g, "").trim();
            };

            // Get all values
            const yearsToRecapture = getCleanValue("yearsToRecapture");
            const lostEquity = getCleanValue("lostEquity");

            // Table values
            const tableData = [
              {
                label: "Purchase Price",
                now: getCleanValue("buyNowPrice"),
                later: getCleanValue("buyLaterPrice"),
                change: getChangeValue("priceChange"),
                isCurrency: true,
              },
              {
                label: "Down Payment",
                now: getCleanValue("buyNowDown"),
                later: getCleanValue("buyLaterDown"),
                change: getChangeValue("downChange"),
                isCurrency: true,
              },
              {
                label: "Loan Amount",
                now: getCleanValue("buyNowLoan"),
                later: getCleanValue("buyLaterLoan"),
                change: getChangeValue("loanChange"),
                isCurrency: true,
              },
              {
                label: "Loan Payment",
                now: getCleanValue("buyNowPayment"),
                later: getCleanValue("buyLaterPayment"),
                change: getChangeValue("paymentChange"),
                isCurrency: true,
              },
              {
                label: "Average Fees",
                now: getCleanValue("buyNowFees"),
                later: getCleanValue("buyLaterFees"),
                change: getChangeValue("feesChange"),
                isCurrency: true,
              },
              {
                label: "Interest Rate",
                now: getCleanValue("buyNowRate"),
                later: getCleanValue("buyLaterRate"),
                change: getChangeValue("rateChangeDisplay"),
                isCurrency: false,
              },
              {
                label: "Estimated APR",
                now: getCleanValue("buyNowAPR"),
                later: getCleanValue("buyLaterAPR"),
                change: getChangeValue("aprChange"),
                isCurrency: false,
              },
            ];

            // Title section
            doc.setFontSize(22);
            doc.text("Understand the Cost of Waiting", 105, 35, {
              align: "center",
            });

            doc.setFontSize(12);
            doc.setTextColor(107, 114, 128); // text-gray-500
            doc.text(
              "Waiting could save you monthly but it will cost you thousands more over the life of the loan.",
              105,
              41,
              { align: "center", maxWidth: 160 }
            );

            // Metrics section
            doc.setFontSize(14);
            doc.setFont("helvetica", "bolditalic");
            doc.setTextColor(75, 85, 99); // text-gray-600

            // First metric box
            doc.setFillColor(255, 255, 255); // bg-white
            doc.roundedRect(25, 50, 75, 30, 3, 3, "F");
            doc.text("Years to Recapture", 62.5, 57, { align: "center" });
            doc.text("Lost Equity", 62.5, 64, { align: "center" });
            doc.setFontSize(24);
            doc.setFont("helvetica", "bold");
            doc.setTextColor(31, 41, 55); // text-gray-800
            doc.text(yearsToRecapture, 62.5, 75, { align: "center" });

            // Second metric box
            doc.setFillColor(255, 255, 255); // bg-white
            doc.roundedRect(110, 50, 75, 30, 3, 3, "F");
            doc.setFontSize(14);
            doc.setFont("helvetica", "bolditalic");
            doc.setTextColor(75, 85, 99); // text-gray-600
            doc.text("Lost Equity and", 147.5, 57, { align: "center" });
            doc.text("Down Payment", 147.5, 64, { align: "center" });
            doc.setFontSize(24);
            doc.setFont("helvetica", "bold");
            doc.setTextColor(31, 41, 55); // text-gray-800
            doc.text(lostEquity, 147.5, 75, { align: "center" });

            // Table header
            doc.setFillColor(249, 250, 251); // Light gray background
            doc.rect(20, 95, 170, 10, "F");
            doc.setFontSize(12);
            doc.setTextColor(75, 85, 99); // text-gray-600
            doc.text("", 30, 102); // Empty first column
            doc.text("Buy Now", 85, 102, { align: "right" });
            doc.text("Buy Later", 140, 102, { align: "right" });
            doc.text("Change", 185, 102, { align: "right" });

            // SVG icons as paths
            const upArrowSVG = "M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z";
            const downArrowSVG = "M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z";

            // Table rows
            let yPos = 110;
            tableData.forEach((row) => {
              // Alternate row colors
              doc.setFillColor(tableData.indexOf(row) % 2 === 0 ? 255 : 249); // White/Gray
              doc.rect(20, yPos - 5, 170, 8, "F");

              // Label (left-aligned)
              doc.setTextColor(31, 41, 55); // Dark gray
              doc.text(row.label, 30, yPos);

              // Values (right-aligned)
              doc.text(row.now, 85, yPos, { align: "right" });
              doc.text(row.later, 140, yPos, { align: "right" });

              // Change value with icon and color
              const changeValue = formatChangeValue(
                row.change.value,
                row.isCurrency
              );
              const iconX = 180; // Position for icon
              const textX = 185; // Position for text

              if (row.change.type === "increase") {
                // Draw red up arrow
                doc.setDrawColor(220, 38, 38);
                doc.setFillColor(220, 38, 38);
                doc.path(upArrowSVG, "S", iconX, yPos - 2, 2, 2);

                // Add value text
                doc.setTextColor(220, 38, 38);
                doc.text(changeValue, textX, yPos, { align: "right" });
              } else if (row.change.type === "decrease") {
                // Draw green down arrow
                doc.setDrawColor(5, 150, 105);
                doc.setFillColor(5, 150, 105);
                doc.path("&darr;", "S", iconX, yPos - 2, 2, 2);

                // Add value text
                doc.setTextColor(5, 150, 105);
                doc.text(changeValue, textX, yPos, { align: "right" });
              } else {
                doc.text(changeValue, textX, yPos, { align: "right" });
              }

              yPos += 8; // Next row
            });

            // Footer
            doc.setFontSize(10);
            doc.setTextColor(156, 163, 175); // text-gray-400
            doc.text(
              "Values are for illustration purposes only.",
              105,
              yPos + 10,
              { align: "center" }
            );

            // Disclaimer
            doc.setFontSize(8);
            const disclaimer =
              "Disclaimer: This calculator is intended for educational purposes only. All figures are estimates based on borrower-provided inputs and do not represent a formal loan offer. Actual results may vary. For personalized information based on your situation, please speak directly with your loan advisor.";
            doc.text(disclaimer, 105, yPos + 15, {
              maxWidth: 170,
              align: "center",
            });

            // Generation date
            const today = new Date().toLocaleDateString();
            doc.text(`Generated: ${today}`, 190, 290, { align: "right" });

            // Save the PDF
            doc.save("Mortgage_Cost_of_Waiting_Report.pdf");

            // Helper function to format change values
            function formatChangeValue(value, isCurrency) {
              if (isCurrency) {
                return new Intl.NumberFormat("en-US", {
                  style: "currency",
                  currency: "USD",
                  minimumFractionDigits: 0,
                  maximumFractionDigits: 0,
                }).format(Math.abs(value));
              } else {
                return Math.abs(value).toFixed(2) + "%";
              }
            }
          });
        function calculateResults() {
          // Get input values
          const purchasePrice = parseFloat(
            document.getElementById("purchasePrice").value
          );
          const downPaymentPercent =
            parseFloat(document.getElementById("downPayment").value) / 100;
          const interestRate =
            parseFloat(document.getElementById("interestRate").value) / 100;
          const averageFees =
            parseFloat(document.getElementById("averageFees").value) / 100;
          const homeAppreciation =
            parseFloat(document.getElementById("homeAppreciation").value) / 100;
          const rateChange =
            parseFloat(document.getElementById("rateChange").value) / 100;

          // Calculate Buy Now values
          const buyNowDownPayment = purchasePrice * downPaymentPercent;
          const buyNowLoanAmount = purchasePrice - buyNowDownPayment;
          const buyNowFees = buyNowLoanAmount * averageFees;
          const buyNowMonthlyRate = interestRate / 12;
          const buyNowLoanTermMonths = 30 * 12;
          const buyNowMonthlyPayment = calculateMonthlyPayment(
            buyNowLoanAmount,
            buyNowMonthlyRate,
            buyNowLoanTermMonths
          );
          const buyNowAPR = interestRate + averageFees * 0.8; // Simplified APR calculation

          // Calculate Buy Later values
          const buyLaterPrice = purchasePrice * (1 + homeAppreciation);
          const buyLaterDownPayment = buyLaterPrice * downPaymentPercent;
          const buyLaterLoanAmount = buyLaterPrice - buyLaterDownPayment;
          const buyLaterInterestRate = interestRate + rateChange;
          const buyLaterFees = buyLaterLoanAmount * averageFees;
          const buyLaterMonthlyRate = buyLaterInterestRate / 12;
          const buyLaterLoanTermMonths = 30 * 12;
          const buyLaterMonthlyPayment = calculateMonthlyPayment(
            buyLaterLoanAmount,
            buyLaterMonthlyRate,
            buyLaterLoanTermMonths
          );
          const buyLaterAPR = buyLaterInterestRate + averageFees * 0.8; // Simplified APR calculation

          // Calculate changes
          const priceChange = buyLaterPrice - purchasePrice;
          const downPaymentChange = buyLaterDownPayment - buyNowDownPayment;
          const loanAmountChange = buyLaterLoanAmount - buyNowLoanAmount;
          const monthlyPaymentChange =
            buyLaterMonthlyPayment - buyNowMonthlyPayment;
          const feesChange = buyLaterFees - buyNowFees;
          const aprChange = buyLaterAPR - buyNowAPR;

          // Calculate lost equity
          const lostEquityValue = downPaymentChange + feesChange;

          //========================================================

          // Add after monthly payment calculations
          const principalPaidYr1 = calculateFirstYearPrincipal(
            buyNowLoanAmount,
            buyNowMonthlyRate,
            buyNowMonthlyPayment
          );
          const extraDownPmt = buyLaterDownPayment - buyNowDownPayment;
          const lostEqAndDP = principalPaidYr1 + extraDownPmt;

          // Helper function to calculate first year principal
          function calculateFirstYearPrincipal(
            loanAmount,
            monthlyRate,
            monthlyPayment
          ) {
            let balance = loanAmount;
            let totalPrincipal = 0;

            for (let month = 1; month <= 12; month++) {
              const interest = balance * monthlyRate;
              const principal = monthlyPayment - interest;
              totalPrincipal += principal;
              balance -= principal;
            }

            return totalPrincipal;
          }

          const delta = buyLaterInterestRate - interestRate;
          const label = delta >= 0 ? "higher" : "lower";
          const ui = `${Math.abs(delta).toFixed(2)}% ${label}`;

          //====================================================

          // Calculate years to recapture
          // Simplified calculation: lost equity divided by monthly payment savings (if any)
          let yearsToRecapture = 10; // Default value
          if (monthlyPaymentChange < 0) {
            // If there are monthly savings
            yearsToRecapture = Math.abs(
              Math.round(
                lostEquityValue / (Math.abs(monthlyPaymentChange) * 12)
              )
            );
          }

          // Update the display with singular/plural year handling
          const yearText = yearsToRecapture === 1 ? "Year" : "Years";
          document.getElementById(
            "yearsToRecapture"
          ).textContent = `${yearsToRecapture} ${yearText}`;
          document.getElementById("lostEquity").textContent =
            formatCurrency(lostEquityValue);

          // Update table values
          document.getElementById("buyNowPrice").textContent =
            formatCurrency(purchasePrice);
          document.getElementById("buyLaterPrice").textContent =
            formatCurrency(buyLaterPrice);
          document.getElementById("priceChange").textContent =
            formatChange(priceChange);
          document.getElementById("priceChange").className =
            priceChange > 0
              ? "px-6 py-4 text-sm increase"
              : "px-6 py-4 text-sm decrease";
          //================================================================================
          // Update LE/DP (KPI Tile + Tooltip Only)
          document.getElementById("lostEquity").textContent =
            formatCurrency(lostEqAndDP);
          document.getElementById("tooltipPrincipal").textContent =
            formatCurrency(principalPaidYr1);
          document.getElementById("tooltipExtraDown").textContent =
            formatCurrency(extraDownPmt);
          document.getElementById("tooltipTotal").textContent =
            formatCurrency(lostEqAndDP);

          document.getElementById(
            "rateChangeDisplay"
          ).textContent = `${Math.abs(delta).toFixed(2)}% ${label}`;
          document.getElementById("rateChangeDisplay").className =
            delta >= 0
              ? "px-6 py-4 text-sm text-danger"
              : "px-6 py-4 text-sm text-success";

          // Update Rate Tooltip
          document.getElementById("tooltipCurrentRate").textContent =
            formatPercent(interestRate);
          document.getElementById("tooltipFutureRate").textContent =
            formatPercent(buyLaterInterestRate);
          document.getElementById(
            "tooltipRateChange"
          ).textContent = `${formatPercentChange(delta)} ${label}`;
          //==========================================================================

          document.getElementById("buyNowDown").textContent =
            formatCurrency(buyNowDownPayment);
          document.getElementById("buyLaterDown").textContent =
            formatCurrency(buyLaterDownPayment);
          document.getElementById("downChange").textContent =
            formatChange(downPaymentChange);
          document.getElementById("downChange").className =
            downPaymentChange > 0
              ? "px-6 py-4 text-sm increase"
              : "px-6 py-4 text-sm decrease";

          document.getElementById("buyNowLoan").textContent =
            formatCurrency(buyNowLoanAmount);
          document.getElementById("buyLaterLoan").textContent =
            formatCurrency(buyLaterLoanAmount);
          document.getElementById("loanChange").textContent =
            formatChange(loanAmountChange);
          document.getElementById("loanChange").className =
            loanAmountChange > 0
              ? "px-6 py-4 text-sm increase"
              : "px-6 py-4 text-sm decrease";

          document.getElementById("buyNowPayment").textContent =
            formatCurrency(buyNowMonthlyPayment);
          document.getElementById("buyLaterPayment").textContent =
            formatCurrency(buyLaterMonthlyPayment);
          document.getElementById("paymentChange").textContent =
            formatChange(monthlyPaymentChange);
          document.getElementById("paymentChange").className =
            monthlyPaymentChange > 0
              ? "px-6 py-4 text-sm increase"
              : "px-6 py-4 text-sm decrease";

          document.getElementById("buyNowFees").textContent =
            formatCurrency(buyNowFees);
          document.getElementById("buyLaterFees").textContent =
            formatCurrency(buyLaterFees);
          document.getElementById("feesChange").textContent =
            formatChange(feesChange);
          document.getElementById("feesChange").className =
            feesChange > 0
              ? "px-6 py-4 text-sm increase"
              : "px-6 py-4 text-sm decrease";

          document.getElementById("buyNowRate").textContent =
            formatPercent(interestRate);
          document.getElementById("buyLaterRate").textContent =
            formatPercent(buyLaterInterestRate);
          document.getElementById("rateChangeDisplay").textContent =
            formatPercentChange(rateChange);
          document.getElementById("rateChangeDisplay").className =
            rateChange > 0
              ? "px-6 py-4 text-sm increase"
              : "px-6 py-4 text-sm decrease";

          document.getElementById("buyNowAPR").textContent =
            formatPercent(buyNowAPR);
          document.getElementById("buyLaterAPR").textContent =
            formatPercent(buyLaterAPR);
          document.getElementById("aprChange").textContent =
            formatPercentChange(aprChange);
          document.getElementById("aprChange").className =
            aprChange > 0
              ? "px-6 py-4 text-sm increase"
              : "px-6 py-4 text-sm decrease";
        }

        function calculateMonthlyPayment(loanAmount, monthlyRate, termMonths) {
          if (monthlyRate === 0) return loanAmount / termMonths;
          return (
            (loanAmount *
              (monthlyRate * Math.pow(1 + monthlyRate, termMonths))) /
            (Math.pow(1 + monthlyRate, termMonths) - 1)
          );
        }

        function formatCurrency(value) {
          return new Intl.NumberFormat("en-US", {
            style: "currency",
            currency: "USD",
            maximumFractionDigits: 0,
          }).format(value);
        }

        function formatPercent(value) {
          return new Intl.NumberFormat("en-US", {
            style: "percent",
            minimumFractionDigits: 2,
            maximumFractionDigits: 3,
          }).format(value);
        }

        function formatChange(value) {
          const prefix = value > 0 ? "↑ " : "↓ ";
          return (
            prefix +
            new Intl.NumberFormat("en-US", {
              style: "currency",
              currency: "USD",
              maximumFractionDigits: 0,
            }).format(value)
          );
        }

        function formatPercentChange(value) {
          const prefix = value > 0 ? "↑ " : "↓ ";
          return (
            prefix +
            new Intl.NumberFormat("en-US", {
              style: "percent",
              minimumFractionDigits: 2,
              maximumFractionDigits: 3,
            }).format(value)
          );
        }
      });
      //making it secureeee
      // Disable right-click
      /*
      document.addEventListener("contextmenu", function (e) {
        e.preventDefault();
      });

      // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U, Ctrl+S, etc.
      document.onkeydown = function (e) {
        if (
          e.key === "F12" ||
          (e.ctrlKey &&
            e.shiftKey &&
            (e.key === "I" || e.key === "J" || e.key === "C")) ||
          (e.ctrlKey && (e.key === "U" || e.key === "S"))
        ) {
          e.preventDefault();
          return false;
        }
      };
      */
      // securing end
    </script>
  </body>
</html>
